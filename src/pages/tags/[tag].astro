---
import {getCollection} from 'astro:content';
import ArticleItem from '../../components/ArticleItem.astro';
import DefaultLayout from '../../layouts/Default.astro';

export async function getStaticPaths() {
  const allPosts = await getCollection('blog');
  const tags = [...new Set(allPosts.flatMap((post) => post.data.tags))];
  return tags.map((tag) => ({
    params: {tag: encodeURIComponent(tag)},
    props: {posts: allPosts, originalTag: tag},
  }));
}

const {posts, originalTag} = Astro.props;
const filteredPosts = posts.filter((post) => post.data.tags.includes(originalTag));
---

<DefaultLayout title={`${originalTag}の記事一覧`} description={`${originalTag}の記事一覧`}>
  <main class="max-w-(--breakpoint-md) mx-auto py-8 px-4 sm:px-6">
    <h1 class="text-2xl text-white font-bold mb-8">{originalTag}のタグが付いた記事</h1>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
      <div class="md:col-span-2">
        <div class="space-y-2">
          {
            filteredPosts.map((post) => (
              <ArticleItem
                title={post.data.title}
                createdAt={post.data.createdAt}
                url={`/posts/${post.data.slug}`}
                tags={post.data.tags}
              />
            ))
          }
        </div>
      </div>
    </div>
  </main>
</DefaultLayout>
